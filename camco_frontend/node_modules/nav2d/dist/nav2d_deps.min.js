!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.nav2d=n():t.nav2d=n()}("undefined"!=typeof self?self:this,(()=>(()=>{var t={187:t=>{"use strict";function n(t,n,r){r=r||2;var o,u,a,f,c,h,p,v=n&&n.length,d=v?n[0]*r:t.length,x=e(t,0,d,r,!0),g=[];if(!x||x.next===x.prev)return g;if(v&&(x=function(t,n,r,i){var o,u,a,f=[];for(o=0,u=n.length;o<u;o++)(a=e(t,n[o]*i,o<u-1?n[o+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),f.push(y(a));for(f.sort(l),o=0;o<f.length;o++)r=s(f[o],r);return r}(t,n,x,r)),t.length>80*r){o=a=t[0],u=f=t[1];for(var b=r;b<d;b+=r)(c=t[b])<o&&(o=c),(h=t[b+1])<u&&(u=h),c>a&&(a=c),h>f&&(f=h);p=0!==(p=Math.max(a-o,f-u))?32767/p:0}return i(x,g,r,o,u,p,0),g}function e(t,n,e,r,i){var o,u;if(i===S(t,n,e,r)>0)for(o=n;o<e;o+=r)u=O(o,t[o],t[o+1],u);else for(o=e-r;o>=n;o-=r)u=O(o,t[o],t[o+1],u);return u&&x(u,u.next)&&(k(u),u=u.next),u}function r(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!x(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(k(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function i(t,n,e,l,s,c,y){if(t){!y&&c&&function(t,n,e,r){var i=t;do{0===i.z&&(i.z=h(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,o,u,a,f,l=1;do{for(e=t,t=null,o=null,u=0;e;){for(u++,r=e,a=0,n=0;n<l&&(a++,r=r.nextZ);n++);for(f=l;a>0||f>0&&r;)0!==a&&(0===f||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,f--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;e=r}o.nextZ=null,l*=2}while(u>1)}(i)}(t,l,s,c);for(var p,v,d=t;t.prev!==t.next;)if(p=t.prev,v=t.next,c?u(t,l,s,c):o(t))n.push(p.i/e|0),n.push(t.i/e|0),n.push(v.i/e|0),k(t),t=v.next,d=v.next;else if((t=v)===d){y?1===y?i(t=a(r(t),n,e),n,e,l,s,c,2):2===y&&f(t,n,e,l,s,c):i(r(t),n,e,l,s,c,1);break}}}function o(t){var n=t.prev,e=t,r=t.next;if(d(n,e,r)>=0)return!1;for(var i=n.x,o=e.x,u=r.x,a=n.y,f=e.y,l=r.y,s=i<o?i<u?i:u:o<u?o:u,c=a<f?a<l?a:l:f<l?f:l,h=i>o?i>u?i:u:o>u?o:u,y=a>f?a>l?a:l:f>l?f:l,v=r.next;v!==n;){if(v.x>=s&&v.x<=h&&v.y>=c&&v.y<=y&&p(i,a,o,f,u,l,v.x,v.y)&&d(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function u(t,n,e,r){var i=t.prev,o=t,u=t.next;if(d(i,o,u)>=0)return!1;for(var a=i.x,f=o.x,l=u.x,s=i.y,c=o.y,y=u.y,v=a<f?a<l?a:l:f<l?f:l,x=s<c?s<y?s:y:c<y?c:y,g=a>f?a>l?a:l:f>l?f:l,b=s>c?s>y?s:y:c>y?c:y,m=h(v,x,n,e,r),w=h(g,b,n,e,r),_=t.prevZ,O=t.nextZ;_&&_.z>=m&&O&&O.z<=w;){if(_.x>=v&&_.x<=g&&_.y>=x&&_.y<=b&&_!==i&&_!==u&&p(a,s,f,c,l,y,_.x,_.y)&&d(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,O.x>=v&&O.x<=g&&O.y>=x&&O.y<=b&&O!==i&&O!==u&&p(a,s,f,c,l,y,O.x,O.y)&&d(O.prev,O,O.next)>=0)return!1;O=O.nextZ}for(;_&&_.z>=m;){if(_.x>=v&&_.x<=g&&_.y>=x&&_.y<=b&&_!==i&&_!==u&&p(a,s,f,c,l,y,_.x,_.y)&&d(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;O&&O.z<=w;){if(O.x>=v&&O.x<=g&&O.y>=x&&O.y<=b&&O!==i&&O!==u&&p(a,s,f,c,l,y,O.x,O.y)&&d(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function a(t,n,e){var i=t;do{var o=i.prev,u=i.next.next;!x(o,u)&&g(o,i,i.next,u)&&w(o,u)&&w(u,o)&&(n.push(o.i/e|0),n.push(i.i/e|0),n.push(u.i/e|0),k(i),k(i.next),i=t=u),i=i.next}while(i!==t);return r(i)}function f(t,n,e,o,u,a){var f=t;do{for(var l=f.next.next;l!==f.prev;){if(f.i!==l.i&&v(f,l)){var s=_(f,l);return f=r(f,f.next),s=r(s,s.next),i(f,n,e,o,u,a,0),void i(s,n,e,o,u,a,0)}l=l.next}f=f.next}while(f!==t)}function l(t,n){return t.x-n.x}function s(t,n){var e=function(t,n){var e,r=n,i=t.x,o=t.y,u=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>u&&(u=a,e=r.x<r.next.x?r:r.next,a===i))return e}r=r.next}while(r!==n);if(!e)return null;var f,l=e,s=e.x,h=e.y,y=1/0;r=e;do{i>=r.x&&r.x>=s&&i!==r.x&&p(o<h?i:u,o,s,h,o<h?u:i,o,r.x,r.y)&&(f=Math.abs(o-r.y)/(i-r.x),w(r,t)&&(f<y||f===y&&(r.x>e.x||r.x===e.x&&c(e,r)))&&(e=r,y=f)),r=r.next}while(r!==l);return e}(t,n);if(!e)return n;var i=_(e,t);return r(i,i.next),r(e,e.next)}function c(t,n){return d(t.prev,t,n.prev)<0&&d(n.next,t,t.next)<0}function h(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function y(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function p(t,n,e,r,i,o,u,a){return(i-u)*(n-a)>=(t-u)*(o-a)&&(t-u)*(r-a)>=(e-u)*(n-a)&&(e-u)*(o-a)>=(i-u)*(r-a)}function v(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&g(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(w(t,n)&&w(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,o=(t.y+n.y)/2;do{e.y>o!=e.next.y>o&&e.next.y!==e.y&&i<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(d(t.prev,t,n.prev)||d(t,n.prev,n))||x(t,n)&&d(t.prev,t,t.next)>0&&d(n.prev,n,n.next)>0)}function d(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function x(t,n){return t.x===n.x&&t.y===n.y}function g(t,n,e,r){var i=m(d(t,n,e)),o=m(d(t,n,r)),u=m(d(e,r,t)),a=m(d(e,r,n));return i!==o&&u!==a||!(0!==i||!b(t,e,n))||!(0!==o||!b(t,r,n))||!(0!==u||!b(e,t,r))||!(0!==a||!b(e,n,r))}function b(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function m(t){return t>0?1:t<0?-1:0}function w(t,n){return d(t.prev,t,t.next)<0?d(t,n,t.next)>=0&&d(t,t.prev,n)>=0:d(t,n,t.prev)<0||d(t,t.next,n)<0}function _(t,n){var e=new P(t.i,t.x,t.y),r=new P(n.i,n.x,n.y),i=t.next,o=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function O(t,n,e,r){var i=new P(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function k(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function P(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,n,e,r){for(var i=0,o=n,u=e-r;o<e;o+=r)i+=(t[u]-t[o])*(t[o+1]+t[u+1]),u=o;return i}t.exports=n,t.exports.default=n,n.deviation=function(t,n,e,r){var i=n&&n.length,o=i?n[0]*e:t.length,u=Math.abs(S(t,0,o,e));if(i)for(var a=0,f=n.length;a<f;a++){var l=n[a]*e,s=a<f-1?n[a+1]*e:t.length;u-=Math.abs(S(t,l,s,e))}var c=0;for(a=0;a<r.length;a+=3){var h=r[a]*e,y=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((t[h]-t[p])*(t[y+1]-t[h+1])-(t[h]-t[y])*(t[p+1]-t[h+1]))}return 0===u&&0===c?0:Math.abs((c-u)/u)},n.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var u=0;u<n;u++)e.vertices.push(t[i][o][u]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e}},895:t=>{t.exports=function(t,n,e,r){var i=t[0],o=t[1],u=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=(r-e)/2,f=0,l=a-1;f<a;l=f++){var s=n[e+2*f+0],c=n[e+2*f+1],h=n[e+2*l+0],y=n[e+2*l+1];c>o!=y>o&&i<(h-s)*(o-c)/(y-c)+s&&(u=!u)}return u}},960:(t,n,e)=>{var r=e(895),i=e(139);t.exports=function(t,n,e,o){return n.length>0&&Array.isArray(n[0])?i(t,n,e,o):r(t,n,e,o)},t.exports.nested=i,t.exports.flat=r},139:t=>{t.exports=function(t,n,e,r){var i=t[0],o=t[1],u=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=r-e,f=0,l=a-1;f<a;l=f++){var s=n[f+e][0],c=n[f+e][1],h=n[l+e][0],y=n[l+e][1];c>o!=y>o&&i<(h-s)*(o-c)/(y-c)+s&&(u=!u)}return u}},788:t=>{t.exports=function(t,n,e,r,i){("number"!=typeof t||isNaN(t))&&(t=0),("number"!=typeof n||isNaN(n))&&(n=0),("number"!=typeof e||isNaN(e))&&(e=10),("number"!=typeof r||isNaN(r))&&(r=10);var o=25,u=.5;function a(t){return!!t&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.w&&"number"==typeof t.h&&!(isNaN(t.x)||isNaN(t.y)||isNaN(t.w)||isNaN(t.h))&&!(t.w<0||t.h<0)}function f(t,n){return t.x==n.x&&t.y==n.y&&t.w==n.w&&t.h==n.h}function l(t,n,e,r){return{x:t,y:n,w:e,h:r,c:[],l:[],n:[]}}i&&("number"==typeof i.maxchildren&&i.maxchildren>0&&(o=i.maxchildren),"number"==typeof i.leafratio&&i.leafratio>=0&&(u=i.leafratio));var s=l(t,n,e,r);function c(t,n,e,r){return Math.sqrt((e-t)*(e-t)+(r-n)*(r-n))}function h(t,n,e){if(!t||!n)return!0;var r=function(t,n,e,r,i,o,u){u||(u=-1);var a=i*i+o*o;if(0==a)return null;if(a=(t*o-n*i-e*o+r*i)/a,Math.abs(i)>Math.abs(o))var f=(t-e-a*o)/i;else f=(n-r+a*i)/o;return f>=0&&f<=u||u<0?{s:f,t:a,x:e+f*i,y:r+f*o,dist:Math.abs(a)}:f<0?{s:f,dist:c(t,n,e,r)}:{s:f,dist:c(t,n,e+u*i,r+u*o)}}(n.x+.5*n.w,n.y+.5*n.h,t.x,t.y,t.dx,t.dy,t.dist);if(r){if(r.dist-=e,r.dist<0)return!0;if(r.dist*r.dist<=n.w*n.w+n.h*n.h)return!0}return!1}function y(t,n,e){return!t||!n||!(t.x+t.w<n.x-e||t.y+t.h<n.y-e||t.x-e>n.x+n.w||t.y-e>n.y+n.h)}function p(t,n){var e=!1;n.w*n.h>t.w*t.h*u&&(e=!0),(n.x<t.x||n.y<t.y||n.x+n.w>t.x+t.w||n.y+n.h>t.y+t.h)&&(e=!0);for(var r=null,i=0;i<t.n.length;i++)if(y(n,t.n[i],0)){if(r){e=!0;break}r=t.n[i]}return{leaf:e,childnode:r}}function v(t,n){var e=p(t,n);if(e.leaf)t.l.push(n);else{if(!e.childnode)return;b(e.childnode,n)}}function d(t,n){t.x="number"==typeof n.x?n.x:t.x,t.y="number"==typeof n.y?n.y:t.y,t.w="number"==typeof n.w?n.w:t.w,t.h="number"==typeof n.h?n.h:t.h}function x(t,n,e,r){if("object"==typeof e&&void 0===r&&(r=e,e=!1),!a(n)||void 0===r)return!1;e?"string"!=typeof e&&(e="id"):e=!1;for(var i=0;i<t.c.length;i++)if(e&&t.c[i][e]==n[e]||!e&&f(t.c[i],n))return d(o=t.c[i],r),(o.x>t.x+t.w||o.y>t.y+t.h||o.x+o.w<t.x||o.y+o.h<t.y)&&(t.c.splice(i,1),b(s,o)),!0;for(i=0;i<t.l.length;i++)if(e&&t.l[i][e]==n[e]||!e&&f(t.l[i],n)){var o;return d(o=t.l[i],r),(o.x>t.x+t.w||o.y>t.y+t.h||o.x+o.w<t.x||o.y+o.h<t.y)&&(t.l.splice(i,1),b(s,o)),!0}var u=p(t,n);return!(u.leaf||!u.childnode||!x(u.childnode,n,e))}function g(t,n,e){if(!a(n))return 0;e?"string"!=typeof e&&(e="id"):e=!1;for(var r=0,i=0;i<t.c.length;i++)(e&&t.c[i][e]==n[e]||!e&&f(t.c[i],n))&&(r++,t.c.splice(i,1),i--);for(i=0;i<t.l.length;i++)(e&&t.l[i][e]==n[e]||!e&&f(t.l[i],n))&&(r++,t.l.splice(i,1),i--);var o=p(t,n);return!o.leaf&&o.childnode?r+g(o.childnode,n,e):r}function b(t,n){if(a(n))if(0==t.n.length){if(t.c.push(n),t.c.length>o){var e=t.w/2,r=t.h/2;t.n.push(l(t.x,t.y,e,r),l(t.x+e,t.y,e,r),l(t.x,t.y+r,e,r),l(t.x+e,t.y+r,e,r));for(var i=0;i<t.c.length;i++)v(t,t.c[i]);t.c=[]}}else v(t,n)}function m(t,n,e,r,i,o){for(var u=0;u<n.l.length;u++)if(!i||t(e,n.l[u],r))if("object"==typeof o)o.push(n.l[u]);else if(!o(n.l[u]))return!1;for(u=0;u<n.c.length;u++)if(!i||t(e,n.c[u],r))if("object"==typeof o)o.push(n.c[u]);else if(!o(n.c[u]))return!1;for(var a=0;a<n.n.length;a++)if(t(e,n.n[a],r))if("object"==typeof o)o.concat(m(t,n.n[a],e,r,i,o));else if(!m(t,n.n[a],e,r,i,o))return!1;return!0}function w(t,n,e,r){return m(y,t,n,e,!0,r)}return{get:function(t,n,e){return function(t,n,e,r){if("function"!=typeof e&&"object"!=typeof e||void 0!==r||(r=e,e=0),void 0===r&&(r=[],e=0),null==n?w(t,n,e,r):"number"!=typeof n.x||"number"!=typeof n.y||isNaN(n.x)||isNaN(n.y)||("number"!=typeof n.dx||"number"!=typeof n.dy||isNaN(n.dx)||isNaN(n.dy)?"number"!=typeof n.w||"number"!=typeof n.h||isNaN(n.w)||isNaN(n.h)||w(t,n,e,r):function(t,n,e,r){m(h,t,n,e,!1,r)}(t,n,e,r)),"object"==typeof r)return r}(s,t,n,e)},put:function(t){b(s,t)},update:function(t,n,e){return x(s,t,n,e)},remove:function(t,n){return g(s,t,n)},clear:function(){s=l(t,n,e,r)},stringify:function(){var i={x:t,y:n,w:e,h:r,maxc:o,leafratio:u,root:s};try{return JSON.stringify(i)}catch(t){return null}},parse:function(i){"string"==typeof i&&(i=JSON.parse(i)),t=i.x,n=i.y,e=i.w,r=i.h,o=i.maxc,u=i.leafratio,s=i.root}}}}},n={};function e(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={exports:{}};return t[r](o,o.exports,e),o.exports}e.d=(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(n,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,(void 0,o=function(n,e){if("object"!==t(n)||null===n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var i=r.call(n,"string");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(i.key),"symbol"===t(o)?o:String(o)),i)}var o}e.r(r),e.d(r,{Edge:()=>D,NavMesh:()=>L,Point:()=>Q,Polygon:()=>T,Vector:()=>u,clip:()=>s,cross:()=>f,dot:()=>a,isclose:()=>l});var i,o=1e-8,u=function(){function t(n,e){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),"number"!=typeof n||"number"!=typeof e)throw new Error("Vector components must be numbers.");this.x=n,this.y=e}var e,r;return e=t,(r=[{key:"_normOther",value:function(n){return"number"==typeof n?new t(n,n):n}},{key:"add",value:function(n){return n=this._normOther(n),new t(this.x+n.x,this.y+n.y)}},{key:"sub",value:function(n){return n=this._normOther(n),new t(this.x-n.x,this.y-n.y)}},{key:"mul",value:function(n){return n=this._normOther(n),new t(this.x*n.x,this.y*n.y)}},{key:"div",value:function(n){return n=this._normOther(n),new t(this.x/n.x,this.y/n.y)}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return l(this.x,t.x)&&l(this.y,t.y)}},{key:"angle",value:function(t){return Math.acos(s(-1,1,a(this,t)/(this.length()*t.length())))}},{key:"counterclockwiseAngle",value:function(t){var n=this.angle(t);return f(this,t)>=0?n:2*Math.PI-n}},{key:"toString",value:function(){return"{ x: ".concat(this.x,", y: ").concat(this.y," }")}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function a(t,n){return t.x*n.x+t.y*n.y}function f(t,n){return t.x*n.y-t.y*n.x}function l(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o;return t>n-e&&t<n+e}function s(t,n,e){return e<t?t:e>n?n:e}var c=new Uint8Array(16);function h(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(c)}const y=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var p=[],v=0;v<256;++v)p.push((v+256).toString(16).substr(1));const d=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(p[t[n+0]]+p[t[n+1]]+p[t[n+2]]+p[t[n+3]]+"-"+p[t[n+4]]+p[t[n+5]]+"-"+p[t[n+6]]+p[t[n+7]]+"-"+p[t[n+8]]+p[t[n+9]]+"-"+p[t[n+10]]+p[t[n+11]]+p[t[n+12]]+p[t[n+13]]+p[t[n+14]]+p[t[n+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&y.test(t)}(e))throw TypeError("Stringified UUID is invalid");return e},x=function(t,n,e){var r=(t=t||{}).random||(t.rng||h)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,n){e=e||0;for(var i=0;i<16;++i)n[e+i]=r[i];return n}return d(r)};var g=e(960),b=e(187),m=e(788);class w{constructor(t=[],n=_){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,o=n[i];if(e(r,o)>=0)break;n[t]=o,t=i}n[t]=r}_down(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),o=n[r];const u=r+1;if(u<this.length&&e(n[u],o)<0&&(r=u,o=n[u]),e(o,i)>=0)break;n[t]=o,t=r}n[t]=i}}function _(t,n){return t<n?-1:t>n?1:0}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function k(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function P(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?k(Object(e),!0).forEach((function(n){S(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):k(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function S(t,n,e){return(n=F(n))in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function j(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,i,o,u,a=[],f=!0,l=!1;try{if(o=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;f=!1}else for(;!(f=(r=o.call(e)).done)&&(a.push(r.value),a.length!==n);f=!0);}catch(t){l=!0,i=t}finally{try{if(!f&&null!=e.return&&(u=e.return(),Object(u)!==u))return}finally{if(l)throw i}}return a}}(t,n)||I(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=I(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){a=!0,o=t},f:function(){try{u||null==e.return||e.return()}finally{if(a)throw o}}}}function E(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function M(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,F(r.key),r)}}function Z(t,n,e){return n&&M(t.prototype,n),e&&M(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function F(t){var n=function(t,n){if("object"!==O(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===O(n)?n:String(n)}function A(t,n,e){return A=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,n,e){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(t,r));return e&&R(i,e.prototype),i},A.apply(null,arguments)}function R(t,n){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},R(t,n)}function z(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||I(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,n){if(t){if("string"==typeof t)return C(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?C(t,n):void 0}}function C(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function q(t){return t instanceof Array?A(u,z(t)):t instanceof u?t:t.hasOwnProperty("x")&&t.hasOwnProperty("y")?new u(t.x,t.y):void 0}var D=function(){function t(n,e){E(this,t),this._uuid=x(),this.p1=q(n),this.p2=q(e)}return Z(t,[{key:"length",value:function(){return this.p1.sub(this.p2).length()}},{key:"direction",value:function(){return this.p1.sub(this.p2)}},{key:"onEdge",value:function(t){t=q(t);var n=this.p1.sub(t);if(!this.parallel(n))return!1;var e=this.direction(),r=this.length(),i=a(e,n)/(r*r);return i>=0&&i<=1}},{key:"parallel",value:function(t){var n=t instanceof u?t:t.p1.sub(t.p2);return l(f(this.direction(),n),0)}},{key:"collinear",value:function(t){var n=this.direction(),e=this.p1.sub(t.p1),r=this.p1.sub(t.p2);return l(f(n,e),0)&&l(f(n,r),0)}},{key:"overlap",value:function(n){if(!this.collinear(n))throw new Error("Cannot compute overlap of two non-collinear edges.");var e=[];return this.onEdge(n.p1)&&e.push(n.p1),this.onEdge(n.p2)&&e.push(n.p2),n.onEdge(this.p1)&&e.push(this.p1),n.onEdge(this.p2)&&e.push(this.p2),e.length>2&&(e=e.filter((function(t,n){return e.findIndex((function(n){return n.equals(t)}))===n}))),e.length?(1==e.length&&(e=[e[0],e[0]]),A(t,z(e))):null}},{key:"equals",value:function(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)}}]),t}(),T=function(){function t(n){E(this,t),this._uuid=x(),this.points=n.map(q),this.bounds=this._computeBounds()}return Z(t,[{key:"_computeBounds",value:function(){return this.points.reduce((function(t,n){return[Math.min(n.x,t[0]),Math.min(n.y,t[1]),Math.max(n.x,t[2]),Math.max(n.y,t[3])]}),[1/0,1/0,-1/0,-1/0])}},{key:"edges",value:function(){var t=this;return this.points.map((function(n,e){return new D(0==e?t.points[t.points.length-1]:t.points[e-1],n)}))}},{key:"centroid",value:function(){return this.points.reduce((function(t,n){return t.add(n)}),new u(0,0)).div(this.points.length)}},{key:"centroidDistance",value:function(t){return this.centroid().sub(t.centroid()).length()}},{key:"contains",value:function(t){t=q(t);var n=this.points.map(this._toPointArray);return g(this._toPointArray(t),n)||!!this.onEdge(t)}},{key:"_toPointArray",value:function(t){return[t.x,t.y]}},{key:"onEdge",value:function(t){t=q(t);var n,e=N(this.edges());try{for(e.s();!(n=e.n()).done;){var r=n.value;if(r.onEdge(t))return r}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"touches",value:function(t){var n,e=N(this.edges());try{for(e.s();!(n=e.n()).done;){var r=n.value;if((r.onEdge(t.p1)||r.onEdge(t.p2))&&r.collinear(t))return r}}catch(t){e.e(t)}finally{e.f()}return null}},{key:"boundsSize",value:function(){var t=j(this.bounds,4),n=t[0],e=t[1];return{x:n,y:e,w:t[2]-n,h:t[3]-e}}}]),t}(),L=function(){function t(n){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;E(this,t),this._uuid=x(),"function"==typeof(r=P({triangulate:!0,pointQuerySize:.01},r))&&(console.warn("DEPRECATION WARNING: nav2d now uses the signature NavMesh(polygons, options = { costFunc: ..., heuristicFunc: ... }) but you are using the old signature NavMesh(polygons, costFunc, heuristicFunc). Please update, the code will break in a future release."),r.costFunc=r),"function"==typeof i&&(console.warn("DEPRECATION WARNING: nav2d now uses the signature NavMesh(polygons, options = { costFunc: ..., heuristicFunc: ... }) but you are using the old signature NavMesh(polygons, costFunc, heuristicFunc). Please update, the code will break in a future release."),r.heuristicFunc=i),this.costFunc=r.costFunc||function(t,n){return e._computeDistance(t,n)},this.heuristicFunc=r.heuristicFunc||function(t,n){return e._computeDistance(t,n)},r.triangulate&&(n=this._triangulate(n)),this.polygons=n.map((function(t){return new T(t)})),this.pointQuerySize=r.pointQuerySize,this._buildQuadtree(),this._buildNeighbors()}return Z(t,[{key:"_triangulate",value:function(t){var n,e=this,r=[],i=N(t);try{var o=function(){for(var t=n.value,i=b(e._flatten(t)),o=0;o<i.length/3;o++){var u=i.slice(3*o,3*o+3);r.push(u.map((function(n){return t[n]})))}};for(i.s();!(n=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}return r}},{key:"_flatten",value:function(t){var n,e=[],r=N(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;i instanceof Array?e.push.apply(e,z(i)):e.push(i.x,i.y)}}catch(t){r.e(t)}finally{r.f()}return e}},{key:"_buildQuadtree",value:function(){this.qt=m(-1/0,-1/0,1/0,1/0);var t,n=N(this.polygons);try{for(n.s();!(t=n.n()).done;){var e=t.value;this.qt.put(P(P({},e.boundsSize()),{},{polygon:e}))}}catch(t){n.e(t)}finally{n.f()}}},{key:"_buildNeighbors",value:function(){this.polygons.forEach((function(t){return t.neighbors={}}));for(var t=0;t<this.polygons.length;t++){var n,e=this.polygons[t],r=N(this.qt.get(e.boundsSize()));try{for(r.s();!(n=r.n()).done;){var i=n.value.polygon;if(e!==i&&!e.neighbors.hasOwnProperty(i._uuid)){var o=this._computePortal(e,i);if(null!==o&&o.length()>0){var u=j(this._orderLeftRight(e.centroid(),o.p1,o.p2),2),a=u[0],f=u[1];e.neighbors[i._uuid]={polygon:i,portal:new D(a,f)},i.neighbors[e._uuid]={polygon:e,portal:new D(f,a)}}}}}catch(t){r.e(t)}finally{r.f()}}}},{key:"_computePortal",value:function(t,n){var e,r=N(t.edges());try{for(r.s();!(e=r.n()).done;){var i=e.value,o=n.touches(i);if(null!==o)return i.overlap(o)}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"findPath",value:function(t,n){t=q(t),n=q(n);var e=this._findPath(t,n);return e&&this._funnel(t,n,e)}},{key:"_findPath",value:function(t,n){var e=this._findContainingPolygon(t),r=this._findContainingPolygon(n);if(null===e||null===r)return null;for(var i=new w([{cost:0,polygon:e}],(function(t,n){return t.cost-n.cost})),o=S({},e._uuid,null),u=S({},e._uuid,0);i.length;){var a=i.pop().polygon;if(a._uuid===r._uuid)break;for(var f=0,l=Object.values(a.neighbors);f<l.length;f++){var s=l[f].polygon,c=u[a._uuid]+this._computeCost(a,s);(!u.hasOwnProperty(s._uuid)||c<u[s._uuid])&&(i.push({cost:c+this._heuristic(s,r),polygon:s}),u[s._uuid]=c,o[s._uuid]=a)}}return this._reconstructPath(r,o)}},{key:"_computeDistance",value:function(t,n){return t.centroidDistance(n)}},{key:"_computeCost",value:function(t,n){var e=t.neighbors[n._uuid].portal;return this.costFunc(t,n,e)}},{key:"_heuristic",value:function(t,n){return t._uuid==n._uuid?0:this.heuristicFunc(t,n)}},{key:"_findContainingPolygon",value:function(t){var n,e=this.pointQuerySize/2,r={x:t.x-e,y:t.y-e,w:this.pointQuerySize,h:this.pointQuerySize},i=N(this.qt.get(r));try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.polygon.contains(t))return o.polygon}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"_reconstructPath",value:function(t,n){if(!n.hasOwnProperty(t._uuid))return null;for(var e=t,r=[];null!==e;)r.push(e),e=n[e._uuid];return r.reverse()}},{key:"_funnel",value:function(t,n,e){if(0===e.length)throw new Error("Path cannot be empty.");if(1===e.length)return[t,n];var r=[t],i=[],o=[],u=e[0].neighbors[e[1]._uuid].portal;i.push(u.p1),o.push(u.p2);for(var a=1;a<e.length-1;a++){var f=e[a],l=e[a+1],s=f.neighbors[l._uuid].portal;this._extendFunnel(r,i,o,s.p1,s.p2)}return this._extendFunnel(r,i,o,n,n),r}},{key:"_extendFunnel",value:function(t,n,e,r,i){this._extendFunnelSide(t,n,e,!0,r),this._extendFunnelSide(t,n,e,!1,i)}},{key:"_extendFunnelSide",value:function(t,n,e,r,i){var o=t[t.length-1];if(!r){var u=[e,n];n=u[0],e=u[1]}var a=0===n.length?t[t.length-1]:n[n.length-1];if(!i.equals(a)){var f=this._findFirstLeftOfPoint(o,n,i,!0,!r);if(n.length=f,n.push(i),0===f){var l=this._findFirstLeftOfPoint(o,e,i,!1,r);t.push.apply(t,z(e.splice(0,l)))}}}},{key:"_findFirstLeftOfPoint",value:function(t,n,e,r,i){var o;for(o=0;o<n.length;o++)if(i?this._isInLeftRightOrder(t,e,n[o],r):this._isInLeftRightOrder(t,n[o],e,r))return o;return o}},{key:"_isInLeftRightOrder",value:function(t,n,e){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=f(n.sub(t),e.sub(t));return r?i<=0:i<0}},{key:"_orderLeftRight",value:function(t,n,e){return this._isInLeftRightOrder(t,n,e)?[n,e]:[e,n]}}]),t}(),Q=u})(),r})()));
//# sourceMappingURL=nav2d_deps.min.js.map